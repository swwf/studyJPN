<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥èªå–®å­—å­¸ç¿’ç³»çµ±</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ æ—¥èªå–®å­—å­¸ç¿’ç³»çµ±</h1>
            <p>äº’å‹•å¼å­¸ç¿’ä»‹é¢ï¼Œå¹«åŠ©æ‚¨æŒæ¡æ—¥èªåŸºç¤å–®å­—</p>
        </header>

        <div class="fixed-controls">
            <div class="controls">
                <div class="control-group">
                    <div class="mode-toggle">
                        <button class="active" onclick="setMode('study')">å­¸ç¿’æ¨¡å¼</button>
                        <button onclick="setMode('quiz')">æ¸¬é©—æ¨¡å¼</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <input type="text" class="search-box" placeholder="æœå°‹å–®å­—..." onkeyup="searchWords(this.value)">
                </div>
                
                <div class="control-group">
                    <select class="filter-select" onchange="filterByRange(this.value)">
                        <option value="">æ‰€æœ‰ç¯„åœ</option>
                        <option value="1-10">1-10è™Ÿ</option>
                        <option value="11-20">11-20è™Ÿ</option>
                        <option value="21-30">21-30è™Ÿ</option>
                        <option value="31-42">31-42è™Ÿ</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-primary" onclick="randomWord()">éš¨æ©Ÿå–®å­—</button>
                    <button class="btn btn-secondary" onclick="resetView()">é‡ç½®</button>
                    <button class="btn btn-primary" onclick="loadFromJSON()">è¼‰å…¥JSONè³‡æ–™</button>
                </div>

                <div class="control-group">
                    <button class="btn btn-small btn-secondary" onclick="toggleGrouping()">
                        <span id="groupToggleText">æŒ‰è©æ€§åˆ†çµ„</span>
                    </button>
                    
                    <button class="btn btn-small btn-primary" onclick="toggleStudiedOnly()">
                        <span id="studiedToggleText">åªé¡¯ç¤ºå·²å­¸ç¿’</span>
                    </button>
                </div>

                <!-- ç´šåˆ¥ç¯©é¸ -->
                <div class="level-filters">
                    <label>ç´šåˆ¥ï¼š</label>
                    <div class="filter-buttons">
                        <button class="level-btn active" onclick="filterByLevel('N5', this)">N5</button>
                        <button class="level-btn" onclick="filterByLevel('N4', this)">N4</button>
                        <button class="level-btn" onclick="filterByLevel('N3', this)">N3</button>
                        <button class="level-btn" onclick="filterByLevel('N2', this)">N2</button>
                        <button class="level-btn" onclick="filterByLevel('N1', this)">N1</button>
                        <button class="level-btn" onclick="filterByLevel('', this)">å…¨éƒ¨</button>
                    </div>
                </div>

                <!-- è©æ€§ç¯©é¸æŒ‰éˆ• -->
                <div class="pos-filters">
                    <label>è©æ€§ï¼š</label>
                    <div class="filter-buttons">
                        <button class="filter-btn" onclick="filterByPOS('åè©', this)">åè©</button>
                        <button class="filter-btn" onclick="filterByPOS('å‹•è©', this)">å‹•è©</button>
                        <button class="filter-btn" onclick="filterByPOS('å½¢å®¹è©', this)">å½¢å®¹è©</button>
                        <button class="filter-btn" onclick="filterByPOS('å‰¯è©', this)">å‰¯è©</button>
                        <button class="filter-btn" onclick="filterByPOS('ç‰‡èª', this)">ç‰‡èª</button>
                        <button class="filter-btn active" onclick="filterByPOS('', this)">å…¨éƒ¨</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="word-grid" id="wordGrid">
            <div class="loading">è¼‰å…¥ä¸­...</div>
        </div>

        <div class="stats">
            <div class="stats-item">
                <div class="stats-number" id="totalWords">0</div>
                <div class="stats-label">ç¸½å–®å­—æ•¸</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="studiedWords">0</div>
                <div class="stats-label">å·²å­¸ç¿’</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="accuracy">0%</div>
                <div class="stats-label">å®Œæˆç‡</div>
            </div>
        </div>
    </div>

    <script>
        let n5Words = [];
        let currentMode = 'study';
        let studiedWords = new Set();
        let quizResults = [];
        let isGrouped = false;
        let showStudiedOnly = false;
        let currentFilters = {
            search: '',
            pos: '',
            range: '',
            level: 'N5'
        };

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥JSONè³‡æ–™
        document.addEventListener('DOMContentLoaded', function() {
            loadFromJSON();
        });

        // è¼‰å…¥JSONè³‡æ–™
        async function loadFromJSON() {
            try {
                const response = await fetch('N5_words_full.json');
                const data = await response.json();
                n5Words = data.words;
                renderWords();
                updateStats();
                console.log('æˆåŠŸè¼‰å…¥', n5Words.length, 'å€‹å–®å­—');
            } catch (error) {
                console.error('è¼‰å…¥JSONæª”æ¡ˆå¤±æ•—:', error);
                alert('è¼‰å…¥è³‡æ–™å¤±æ•—ï¼š' + error.message);
                useBackupData();
            }
        }

        // å‚™ç”¨è³‡æ–™
        function useBackupData() {
            n5Words = [
                {"id": 1, "number": {"japanese": "ã„ã¡", "romaji": "ichi"}, "word": {"hiragana": "ãã‚‹ã¾", "romaji": "kuruma", "kanji": "è»Š", "meaning": "æ±½è»Š", "part_of_speech": "åè©", "level": "N5"}, "example": {"japanese": "è»Šã‚’é‹è»¢ã—ã¾ã™ã€‚", "romaji": "kuruma o unten shimasu.", "chinese": "é§•é§›æ±½è»Šã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šé›»è»Š (densha - ç«è»Š/é›»è»Š)ã€è‡ªè»¢è»Š (jitensha - è…³è¸è»Š)", "advanced_phrase": {"japanese": "è»ŠãŒå¤§å¥½ãã§ã™ã€‚", "romaji": "kuruma ga daisuki desu.", "chinese": "æˆ‘å¾ˆå–œæ­¡è»Šå­ã€‚"}},
                {"id": 2, "number": {"japanese": "ã«", "romaji": "ni"}, "word": {"hiragana": "ã‚ãŸã‚‰ã—ã„", "romaji": "atarashi", "kanji": "æ–°ã—ã„", "meaning": "æ–°çš„", "part_of_speech": "å½¢å®¹è©", "level": "N5"}, "example": {"japanese": "æ–°ã—ã„æœ¬ã‚’èª­ã¿ã¾ã™ã€‚", "romaji": "atarashii hon o yomimasu.", "chinese": "é–±è®€æ–°æ›¸ã€‚"}, "memory_aid": "åç¾©è©ï¼šå¤ã„ (furui - èˆŠçš„)", "advanced_phrase": {"japanese": "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã€‚", "romaji": "atarashii koto o hajimeru.", "chinese": "é–‹å§‹æ–°çš„äº‹æƒ…ã€‚"}},
                {"id": 3, "number": {"japanese": "ã•ã‚“", "romaji": "san"}, "word": {"hiragana": "ã‚ã†", "romaji": "au", "kanji": "ä¼šã†", "meaning": "è¦‹é¢", "part_of_speech": "å‹•è©", "level": "N5"}, "example": {"japanese": "å‹é”ã«ä¼šã„ã¾ã™ã€‚", "romaji": "tomodachi ni aimasu.", "chinese": "å’Œæœ‹å‹è¦‹é¢ã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šå‡ºä¼šã† (deau - ç›¸é‡)", "advanced_phrase": {"japanese": "å…ˆç”Ÿã«ä¼šã„ã¾ã™ã€‚", "romaji": "sensei ni aimasu.", "chinese": "å’Œè€å¸«è¦‹é¢ã€‚"}},
                {"id": 4, "number": {"japanese": "ã‚ˆã‚“", "romaji": "yon"}, "word": {"hiragana": "ã„ã†", "romaji": "iu", "kanji": "è¨€ã†", "meaning": "èªª", "part_of_speech": "å‹•è©", "level": "N5"}, "example": {"japanese": "ä½•ã‚’è¨€ã„ã¾ã™ã‹ã€‚", "romaji": "nani o iimasu ka.", "chinese": "èªªä»€éº¼ï¼Ÿ"}, "memory_aid": "å¸¸ç”¨æ­é…ï¼šã€Œã¯ã„ã€ã¨è¨€ã†", "advanced_phrase": {"japanese": "å½¼ã¯æ—¥æœ¬èªãŒä¸Šæ‰‹ã«è¨€ãˆã¾ã™ã€‚", "romaji": "kare wa nihongo ga jouzu ni iemasu.", "chinese": "ä»–æ—¥èªèªªå¾—å¾ˆå¥½ã€‚"}},
                {"id": 5, "number": {"japanese": "ã”", "romaji": "go"}, "word": {"hiragana": "ã„ãˆ", "romaji": "ie", "kanji": "å®¶", "meaning": "å®¶", "part_of_speech": "åè©", "level": "N5"}, "example": {"japanese": "ç§ã®å®¶ã¯è¿‘ã„ã§ã™ã€‚", "romaji": "watashi no ie wa chikai desu.", "chinese": "æˆ‘å®¶å¾ˆè¿‘ã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šå®¶æ— (kazoku - å®¶åº­)", "advanced_phrase": {"japanese": "å®¶ã«å¸°ã£ã¦ã‹ã‚‰å®¿é¡Œã‚’ã—ã¾ã™ã€‚", "romaji": "ie ni kaette kara shukudai o shimasu.", "chinese": "å›å®¶å¾Œå¯«ä½œæ¥­ã€‚"}}
            ];
            renderWords();
            updateStats();
            console.log('ä½¿ç”¨å‚™ç”¨è³‡æ–™ï¼Œè¼‰å…¥', n5Words.length, 'å€‹ç¤ºä¾‹å–®å­—');
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-toggle button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderWords();
        }

        // è©æ€§ç¯©é¸
        function filterByPOS(pos, button) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.pos-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            
            // æ›´æ–°ç¯©é¸æ¢ä»¶
            currentFilters.pos = pos;
            renderWords();
        }

        // ç´šåˆ¥ç¯©é¸
        function filterByLevel(level, button) {
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.level-filters .level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            
            // æ›´æ–°ç¯©é¸æ¢ä»¶
            currentFilters.level = level;
            renderWords();
        }

        // ç¯„åœç¯©é¸
        function filterByRange(range) {
            currentFilters.range = range;
            renderWords();
        }

        // æœå°‹ç¯©é¸
        function searchWords(query) {
            currentFilters.search = query;
            renderWords();
        }

        function getFilteredWords() {
            let filteredWords = [...n5Words];

            // æœå°‹ç¯©é¸
            if (currentFilters.search) {
                filteredWords = filteredWords.filter(word => 
                    word.word.hiragana.includes(currentFilters.search) ||
                    word.word.romaji.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                    (word.word.kanji && word.word.kanji.includes(currentFilters.search)) ||
                    word.word.meaning.includes(currentFilters.search)
                );
            }

            // è©æ€§ç¯©é¸
            if (currentFilters.pos) {
                filteredWords = filteredWords.filter(word => 
                    word.word.part_of_speech === currentFilters.pos
                );
            }

            // ç´šåˆ¥ç¯©é¸
            if (currentFilters.level) {
                filteredWords = filteredWords.filter(word => 
                    word.word.level === currentFilters.level
                );
            }

            // ç¯„åœç¯©é¸
            if (currentFilters.range) {
                const [min, max] = currentFilters.range.split('-').map(Number);
                filteredWords = filteredWords.filter(word => 
                    word.id >= min && word.id <= max
                );
            }

            // åªé¡¯ç¤ºå·²å­¸ç¿’
            if (showStudiedOnly) {
                filteredWords = filteredWords.filter(word => 
                    studiedWords.has(word.id)
                );
            }

            return filteredWords;
        }

        function renderWords() {
            const grid = document.getElementById('wordGrid');
            grid.innerHTML = '';

            const filteredWords = getFilteredWords();

            if (filteredWords.length === 0) {
                grid.innerHTML = '<div class="loading">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å–®å­—</div>';
                return;
            }

            if (isGrouped) {
                renderGroupedWords(filteredWords);
            } else {
                filteredWords.forEach(word => {
                    const card = createWordCard(word);
                    grid.appendChild(card);
                });
            }

            updateStats();
        }

        function renderGroupedWords(words) {
            const grid = document.getElementById('wordGrid');
            const groupedWords = {};

            // æŒ‰è©æ€§åˆ†çµ„
            words.forEach(word => {
                const pos = word.word.part_of_speech;
                if (!groupedWords[pos]) {
                    groupedWords[pos] = [];
                }
                groupedWords[pos].push(word);
            });

            // æ¸²æŸ“åˆ†çµ„
            Object.keys(groupedWords).sort().forEach(pos => {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'word-group';
                
                // å‰µå»ºåˆ†çµ„æ¨™é¡Œ
                const groupTitle = document.createElement('h2');
                groupTitle.innerHTML = `${pos} <span class="group-count">(${groupedWords[pos].length}å€‹å–®å­—)</span>`;
                groupDiv.appendChild(groupTitle);
                
                // å‰µå»ºå–®å­—å¡ç‰‡å®¹å™¨
                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'word-grid';
                
                // æ·»åŠ å–®å­—å¡ç‰‡
                groupedWords[pos].forEach(word => {
                    const card = createWordCard(word);
                    cardsContainer.appendChild(card);
                });
                
                groupDiv.appendChild(cardsContainer);
                grid.appendChild(groupDiv);
            });
        }

        function createWordCard(word) {
            const card = document.createElement('div');
            card.className = 'word-card';
            card.dataset.id = word.id;
            
            // æª¢æŸ¥æ˜¯å¦å·²å­¸ç¿’
            if (studiedWords.has(word.id)) {
                card.classList.add('studied');
            }
            
            // é¡¯ç¤ºç´šåˆ¥æ¨™ç±¤
            const levelTag = document.createElement('div');
            levelTag.className = 'level-tag';
            levelTag.textContent = word.word.level;
            card.appendChild(levelTag);
            
            // å–®å­—å…§å®¹
            let cardContent = `
                <h3>${word.word.kanji || word.word.hiragana}</h3>
                <p><span class="part-of-speech pos-${word.word.part_of_speech}">${word.word.part_of_speech}</span></p>
                <p><strong>å¹³å‡åï¼š</strong>${word.word.hiragana}</p>
                <p><strong>ç¾…é¦¬å­—ï¼š</strong>${word.word.romaji}</p>
                <p><strong>ä¸­æ–‡ï¼š</strong>${word.word.meaning}</p>
                <div class="example">
                    <p class="japanese-example">${word.example.japanese}</p>
                    <p>${word.example.romaji}</p>
                    <p>${word.example.chinese}</p>
                </div>
            `;
            
            // å­¸ç¿’æ¨¡å¼ä¸‹é¡¯ç¤ºè¨˜æ†¶è¼”åŠ©
            if (currentMode === 'study') {
                cardContent += `
                    <div class="memory-aid">
                        <h4>è¨˜æ†¶è¼”åŠ©</h4>
                        <p>${word.memory_aid}</p>
                    </div>
                    <div class="advanced">
                        <h4>é€²éšçŸ­èª</h4>
                        <p>${word.advanced_phrase.japanese}</p>
                        <p>${word.advanced_phrase.romaji}</p>
                        <p>${word.advanced_phrase.chinese}</p>
                    </div>
                `;
            }
            
            // æ¸¬é©—æ¨¡å¼ä¸‹é¡¯ç¤ºæ¸¬é©—æŒ‰éˆ•
            if (currentMode === 'quiz') {
                cardContent += `
                    <div class="quiz-buttons">
                        <button onclick="markAsCorrect(${word.id})">æˆ‘æœƒäº†</button>
                        <button onclick="markAsIncorrect(${word.id})">å†å­¸ç¿’</button>
                    </div>
                `;
            }
            
            card.innerHTML = cardContent;
            
            // é»æ“Šå¡ç‰‡æ¨™è¨˜ç‚ºå·²å­¸ç¿’
            card.addEventListener('click', function() {
                if (currentMode === 'study') {
                    toggleStudied(word.id);
                }
            });
            
            return card;
        }

        function toggleStudied(id) {
            if (studiedWords.has(id)) {
                studiedWords.delete(id);
            } else {
                studiedWords.add(id);
            }
            
            // æ›´æ–°å¡ç‰‡å¤–è§€
            const card = document.querySelector(`.word-card[data-id="${id}"]`);
            if (card) {
                card.classList.toggle('studied');
            }
            
            // å¦‚æœåªé¡¯ç¤ºå·²å­¸ç¿’ï¼Œä¸”å–æ¶ˆäº†å­¸ç¿’ç‹€æ…‹ï¼Œå‰‡éœ€è¦é‡æ–°æ¸²æŸ“
            if (showStudiedOnly && !studiedWords.has(id)) {
                renderWords();
            }
            
            updateStats();
            saveStudiedWords();
        }

        function toggleGrouping() {
            isGrouped = !isGrouped;
            document.getElementById('groupToggleText').textContent = isGrouped ? 'å–æ¶ˆåˆ†çµ„' : 'æŒ‰è©æ€§åˆ†çµ„';
            renderWords();
        }

        function toggleStudiedOnly() {
            showStudiedOnly = !showStudiedOnly;
            document.getElementById('studiedToggleText').textContent = showStudiedOnly ? 'é¡¯ç¤ºå…¨éƒ¨' : 'åªé¡¯ç¤ºå·²å­¸ç¿’';
            renderWords();
        }

        function randomWord() {
            const filteredWords = getFilteredWords();
            if (filteredWords.length === 0) return;
            
            const randomIndex = Math.floor(Math.random() * filteredWords.length);
            const randomWord = filteredWords[randomIndex];
            
            // æ»¾å‹•åˆ°éš¨æ©Ÿå–®å­—
            const grid = document.getElementById('wordGrid');
            grid.innerHTML = '';
            const card = createWordCard(randomWord);
            grid.appendChild(card);
            
            // é«˜äº®é¡¯ç¤º
            card.classList.add('highlight');
        }

        function resetView() {
            currentFilters = {
                search: '',
                pos: '',
                range: '',
                level: 'N5'
            };
            
            // é‡ç½®æœå°‹æ¬„
            document.querySelector('.search-box').value = '';
            
            // é‡ç½®ç¯„åœé¸æ“‡
            document.querySelector('.filter-select').selectedIndex = 0;
            
            // é‡ç½®è©æ€§ç¯©é¸æŒ‰éˆ•
            document.querySelectorAll('.pos-filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.pos-filters .filter-btn:last-child').classList.add('active');
            
            // é‡ç½®ç´šåˆ¥ç¯©é¸æŒ‰éˆ•
            document.querySelectorAll('.level-filters .level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.level-filters .level-btn:first-child').classList.add('active');
            
            renderWords();
        }

        function updateStats() {
            document.getElementById('totalWords').textContent = n5Words.length;
            document.getElementById('studiedWords').textContent = studiedWords.size;
            
            const accuracy = n5Words.length > 0 ? Math.round((studiedWords.size / n5Words.length) * 100) : 0;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
        }

        // ä¿å­˜å·²å­¸ç¿’å–®å­—åˆ°æœ¬åœ°å­˜å„²
        function saveStudiedWords() {
            localStorage.setItem('studiedWords', JSON.stringify([...studiedWords]));
        }

        // å¾æœ¬åœ°å­˜å„²è¼‰å…¥å·²å­¸ç¿’å–®å­—
        function loadStudiedWords() {
            const saved = localStorage.getItem('studiedWords');
            if (saved) {
                studiedWords = new Set(JSON.parse(saved));
            }
        }

        // æ¸¬é©—æ¨¡å¼ç›¸é—œå‡½æ•¸
        function markAsCorrect(id) {
            quizResults.push({ id, correct: true });
            toggleStudied(id);
            
            // ç§»é™¤å·²ç­”é¡Œçš„å¡ç‰‡
            const card = document.querySelector(`.word-card[data-id="${id}"]`);
            if (card) {
                card.classList.add('correct');
                setTimeout(() => {
                    card.remove();
                    checkQuizComplete();
                }, 500);
            }
        }

        function markAsIncorrect(id) {
            quizResults.push({ id, correct: false });
            
            // ç§»é™¤å·²ç­”é¡Œçš„å¡ç‰‡
            const card = document.querySelector(`.word-card[data-id="${id}"]`);
            if (card) {
                card.classList.add('incorrect');
                setTimeout(() => {
                    card.remove();
                    checkQuizComplete();
                }, 500);
            }
        }

        function checkQuizComplete() {
            const remainingCards = document.querySelectorAll('.word-card').length;
            if (remainingCards === 0) {
                showQuizResults();
            }
        }

        function showQuizResults() {
            const grid = document.getElementById('wordGrid');
            const correct = quizResults.filter(r => r.correct).length;
            const total = quizResults.length;
            const percentage = Math.round((correct / total) * 100) || 0;
            
            grid.innerHTML = `
                <div class="quiz-results">
                    <h2>æ¸¬é©—çµæœ</h2>
                    <div class="result-score">${percentage}%</div>
                    <p>å…± ${total} é¡Œï¼Œç­”å° ${correct} é¡Œ</p>
                    <button onclick="resetQuiz()">é‡æ–°æ¸¬é©—</button>
                </div>
            `;
        }

        function resetQuiz() {
            quizResults = [];
            renderWords();
        }

        // åˆå§‹åŒ–
        loadStudiedWords();
    </script>
</body>
</html> 