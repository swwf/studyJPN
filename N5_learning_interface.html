<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥èªN5å–®å­—å­¸ç¿’ç³»çµ±</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <div class="container">
        <div class="fixed-header">
            <div class="header">
                <h1>ğŸŒ æ—¥èªN5å–®å­—å­¸ç¿’ç³»çµ±</h1>
                <p>äº’å‹•å¼å­¸ç¿’ä»‹é¢ï¼Œå¹«åŠ©æ‚¨æŒæ¡æ—¥èªåŸºç¤å–®å­—</p>
                <div class="level-badge">N5 ç´šåˆ¥</div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <div class="mode-toggle">
                        <button class="active" onclick="setMode('study')">å­¸ç¿’æ¨¡å¼</button>
                        <button onclick="setMode('quiz')">æ¸¬é©—æ¨¡å¼</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <input type="text" class="search-box" placeholder="æœå°‹å–®å­—..." onkeyup="searchWords(this.value)">
                </div>
                
                <div class="control-group">
                    <select class="filter-select" onchange="filterByRange(this.value)">
                        <option value="">æ‰€æœ‰ç¯„åœ</option>
                        <option value="1-10">1-10è™Ÿ</option>
                        <option value="11-20">11-20è™Ÿ</option>
                        <option value="21-30">21-30è™Ÿ</option>
                        <option value="31-42">31-42è™Ÿ</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <button class="btn btn-primary" onclick="randomWord()">éš¨æ©Ÿå–®å­—</button>
                    <button class="btn btn-secondary" onclick="resetView()">é‡ç½®</button>
                    <button class="btn btn-primary" onclick="loadFromJSON()">è¼‰å…¥JSONè³‡æ–™</button>
                </div>

                <div class="control-group">
                    <button class="btn btn-small btn-secondary" onclick="toggleGrouping()">
                        <span id="groupToggleText">æŒ‰è©æ€§åˆ†çµ„</span>
                    </button>
                    
                    <button class="btn btn-small btn-primary" onclick="toggleStudiedOnly()">
                        <span id="studiedToggleText">åªé¡¯ç¤ºå·²å­¸ç¿’</span>
                    </button>
                </div>

                <!-- è©æ€§ç¯©é¸æŒ‰éˆ• -->
                <div class="pos-filters">
                    <button class="pos-btn noun" onclick="filterByPOS('åè©', this)">
                        <span>åè©</span>
                    </button>
                    <button class="pos-btn verb" onclick="filterByPOS('å‹•è©', this)">
                        <span>å‹•è©</span>
                    </button>
                    <button class="pos-btn adjective" onclick="filterByPOS('å½¢å®¹è©', this)">
                        <span>å½¢å®¹è©</span>
                    </button>
                    <button class="pos-btn adverb" onclick="filterByPOS('å‰¯è©', this)">
                        <span>å‰¯è©</span>
                    </button>
                    <button class="pos-btn other" onclick="filterByPOS('', this)">
                        <span>å…¨éƒ¨</span>
                    </button>
                </div>

                <!-- ç´šåˆ¥ç¯©é¸ -->
                <div class="level-filters">
                    <button class="level-btn active" onclick="filterByLevel('N5', this)">N5</button>
                    <button class="level-btn" onclick="filterByLevel('N4', this)">N4</button>
                    <button class="level-btn" onclick="filterByLevel('N3', this)">N3</button>
                    <button class="level-btn" onclick="filterByLevel('N2', this)">N2</button>
                    <button class="level-btn" onclick="filterByLevel('N1', this)">N1</button>
                    <button class="level-btn" onclick="filterByLevel('', this)">å…¨éƒ¨</button>
                </div>
            </div>
        </div>

        <div class="word-grid" id="wordGrid">
            <div class="loading">è¼‰å…¥ä¸­...</div>
        </div>

        <div class="stats">
            <div class="stats-item">
                <div class="stats-number" id="totalWords">0</div>
                <div class="stats-label">ç¸½å–®å­—æ•¸</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="studiedWords">0</div>
                <div class="stats-label">å·²å­¸ç¿’</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="accuracy">0%</div>
                <div class="stats-label">å®Œæˆç‡</div>
            </div>
        </div>
    </div>

    <script>
        let n5Words = [];
        let currentMode = 'study';
        let studiedWords = new Set();
        let quizResults = [];
        let isGrouped = false;
        let showStudiedOnly = false;
        let currentFilters = {
            search: '',
            pos: '',
            range: '',
            level: 'N5'
        };

        // è¼‰å…¥JSONè³‡æ–™
        async function loadFromJSON() {
            try {
                const response = await fetch('N5_words_full.json');
                const data = await response.json();
                n5Words = data.words;
                renderWords();
                updateStats();
                console.log('æˆåŠŸè¼‰å…¥', n5Words.length, 'å€‹å–®å­—');
            } catch (error) {
                console.error('è¼‰å…¥JSONæª”æ¡ˆå¤±æ•—:', error);
                useBackupData();
            }
        }

        // å‚™ç”¨è³‡æ–™
        function useBackupData() {
            n5Words = [
                {"id": 1, "number": {"japanese": "ã„ã¡", "romaji": "ichi"}, "word": {"hiragana": "ãã‚‹ã¾", "romaji": "kuruma", "kanji": "è»Š", "meaning": "æ±½è»Š", "part_of_speech": "åè©", "level": "N5"}, "example": {"japanese": "è»Šã‚’é‹è»¢ã—ã¾ã™ã€‚", "romaji": "kuruma o unten shimasu.", "chinese": "é§•é§›æ±½è»Šã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šé›»è»Š (densha - ç«è»Š/é›»è»Š)ã€è‡ªè»¢è»Š (jitensha - è…³è¸è»Š)", "advanced_phrase": {"japanese": "è»ŠãŒå¤§å¥½ãã§ã™ã€‚", "romaji": "kuruma ga daisuki desu.", "chinese": "æˆ‘å¾ˆå–œæ­¡è»Šå­ã€‚"}},
                {"id": 2, "number": {"japanese": "ã«", "romaji": "ni"}, "word": {"hiragana": "ã‚ãŸã‚‰ã—ã„", "romaji": "atarashi", "kanji": "æ–°ã—ã„", "meaning": "æ–°çš„", "part_of_speech": "å½¢å®¹è©", "level": "N5"}, "example": {"japanese": "æ–°ã—ã„æœ¬ã‚’èª­ã¿ã¾ã™ã€‚", "romaji": "atarashii hon o yomimasu.", "chinese": "é–±è®€æ–°æ›¸ã€‚"}, "memory_aid": "åç¾©è©ï¼šå¤ã„ (furui - èˆŠçš„)", "advanced_phrase": {"japanese": "æ–°ã—ã„ã“ã¨ã‚’å§‹ã‚ã‚‹ã€‚", "romaji": "atarashii koto o hajimeru.", "chinese": "é–‹å§‹æ–°çš„äº‹æƒ…ã€‚"}},
                {"id": 3, "number": {"japanese": "ã•ã‚“", "romaji": "san"}, "word": {"hiragana": "ã‚ã†", "romaji": "au", "kanji": "ä¼šã†", "meaning": "è¦‹é¢", "part_of_speech": "å‹•è©", "level": "N5"}, "example": {"japanese": "å‹é”ã«ä¼šã„ã¾ã™ã€‚", "romaji": "tomodachi ni aimasu.", "chinese": "å’Œæœ‹å‹è¦‹é¢ã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šå‡ºä¼šã† (deau - ç›¸é‡)", "advanced_phrase": {"japanese": "å…ˆç”Ÿã«ä¼šã„ã¾ã™ã€‚", "romaji": "sensei ni aimasu.", "chinese": "å’Œè€å¸«è¦‹é¢ã€‚"}},
                {"id": 4, "number": {"japanese": "ã‚ˆã‚“", "romaji": "yon"}, "word": {"hiragana": "ã„ã†", "romaji": "iu", "kanji": "è¨€ã†", "meaning": "èªª", "part_of_speech": "å‹•è©", "level": "N5"}, "example": {"japanese": "ä½•ã‚’è¨€ã„ã¾ã™ã‹ã€‚", "romaji": "nani o iimasu ka.", "chinese": "èªªä»€éº¼ï¼Ÿ"}, "memory_aid": "å¸¸ç”¨æ­é…ï¼šã€Œã¯ã„ã€ã¨è¨€ã†", "advanced_phrase": {"japanese": "å½¼ã¯æ—¥æœ¬èªãŒä¸Šæ‰‹ã«è¨€ãˆã¾ã™ã€‚", "romaji": "kare wa nihongo ga jouzu ni iemasu.", "chinese": "ä»–æ—¥èªèªªå¾—å¾ˆå¥½ã€‚"}},
                {"id": 5, "number": {"japanese": "ã”", "romaji": "go"}, "word": {"hiragana": "ã„ãˆ", "romaji": "ie", "kanji": "å®¶", "meaning": "å®¶", "part_of_speech": "åè©", "level": "N5"}, "example": {"japanese": "ç§ã®å®¶ã¯è¿‘ã„ã§ã™ã€‚", "romaji": "watashi no ie wa chikai desu.", "chinese": "æˆ‘å®¶å¾ˆè¿‘ã€‚"}, "memory_aid": "ç›¸é—œè©ï¼šå®¶æ— (kazoku - å®¶åº­)", "advanced_phrase": {"japanese": "å®¶ã«å¸°ã£ã¦ã‹ã‚‰å®¿é¡Œã‚’ã—ã¾ã™ã€‚", "romaji": "ie ni kaette kara shukudai o shimasu.", "chinese": "å›å®¶å¾Œå¯«ä½œæ¥­ã€‚"}}
            ];
            renderWords();
            updateStats();
            console.log('ä½¿ç”¨å‚™ç”¨è³‡æ–™ï¼Œè¼‰å…¥', n5Words.length, 'å€‹ç¤ºä¾‹å–®å­—');
        }

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-toggle button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderWords();
        }

        function getFilteredWords() {
            let filteredWords = [...n5Words];

            // æœå°‹ç¯©é¸
            if (currentFilters.search) {
                filteredWords = filteredWords.filter(word => 
                    word.word.hiragana.includes(currentFilters.search) ||
                    word.word.romaji.toLowerCase().includes(currentFilters.search.toLowerCase()) ||
                    (word.word.kanji && word.word.kanji.includes(currentFilters.search)) ||
                    word.word.meaning.includes(currentFilters.search)
                );
            }

            // è©æ€§ç¯©é¸
            if (currentFilters.pos) {
                filteredWords = filteredWords.filter(word => 
                    word.word.part_of_speech === currentFilters.pos
                );
            }

            // ç´šåˆ¥ç¯©é¸
            if (currentFilters.level) {
                filteredWords = filteredWords.filter(word => 
                    word.word.level === currentFilters.level
                );
            }

            // ç¯„åœç¯©é¸
            if (currentFilters.range) {
                const [min, max] = currentFilters.range.split('-').map(Number);
                filteredWords = filteredWords.filter(word => 
                    word.id >= min && word.id <= max
                );
            }

            // åªé¡¯ç¤ºå·²å­¸ç¿’
            if (showStudiedOnly) {
                filteredWords = filteredWords.filter(word => 
                    studiedWords.has(word.id)
                );
            }

            return filteredWords;
        }

        function renderWords() {
            const grid = document.getElementById('wordGrid');
            grid.innerHTML = '';

            const filteredWords = getFilteredWords();

            if (filteredWords.length === 0) {
                grid.innerHTML = '<div class="loading">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„å–®å­—</div>';
                return;
            }

            if (isGrouped) {
                renderGroupedWords(filteredWords);
            } else {
                filteredWords.forEach(word => {
                    const card = createWordCard(word);
                    grid.appendChild(card);
                });
            }

            updateStats();
        }

        function renderGroupedWords(words) {
            const grid = document.getElementById('wordGrid');
            const groupedWords = {};

            // æŒ‰è©æ€§åˆ†çµ„
            words.forEach(word => {
                const pos = word.word.part_of_speech;
                if (!groupedWords[pos]) {
                    groupedWords[pos] = [];
                }
                groupedWords[pos].push(word);
            });

            // æ¸²æŸ“åˆ†çµ„
            Object.keys(groupedWords).sort().forEach(pos => {
                // å‰µå»ºåˆ†çµ„æ¨™é¡Œ
                const groupHeader = document.createElement('div');
                groupHeader.className = 'group-header';
                groupHeader.innerHTML = `
                    <div class="group-title">
                        <span class="word-type ${getPOSClass(pos)}">${pos}</span>
                        <span>${pos}</span>
                    </div>
                    <div class="group-count">${groupedWords[pos].length} å€‹å–®å­—</div>
                `;
                grid.appendChild(groupHeader);

                // æ¸²æŸ“è©²çµ„çš„å–®å­—
                groupedWords[pos].forEach(word => {
                    const card = createWordCard(word);
                    grid.appendChild(card);
                });
            });
        }

        function getPOSClass(pos) {
            const posMap = {
                'åè©': 'noun',
                'å‹•è©': 'verb',
                'å½¢å®¹è©': 'adjective',
                'å‰¯è©': 'adverb'
            };
            return posMap[pos] || 'other';
        }

        function createWordCard(word) {
            const card = document.createElement('div');
            card.className = 'word-card';
            
            // è™•ç†æ¼¢å­—é¡¯ç¤º
            const displayKanji = word.word.kanji || word.word.hiragana;
            const posClass = getPOSClass(word.word.part_of_speech);
            
            card.innerHTML = `
                <div class="word-header">
                    <div class="word-id">#${word.id} (${word.number.japanese})</div>
                    <div class="word-type ${posClass}">${word.word.part_of_speech}</div>
                </div>
                
                <div class="word-main">
                    <div class="word-kanji">${displayKanji}</div>
                    <div class="word-hiragana">${word.word.hiragana}</div>
                    <div class="word-romaji">${word.word.romaji}</div>
                    <div class="word-meaning">${word.word.meaning}</div>
                </div>

                <div class="example-section">
                    <h4>ğŸ“ ä¾‹å¥</h4>
                    <div class="example-text japanese-text">${word.example.japanese}</div>
                    <div class="example-text romaji-text">${word.example.romaji}</div>
                    <div class="example-text chinese-text">${word.example.chinese}</div>
                </div>

                <div class="memory-aid">
                    <h4>ğŸ’¡ è¨˜æ†¶è¼”åŠ©</h4>
                    <p>${word.memory_aid}</p>
                </div>

                <div class="advanced-phrase">
                    <h4>ğŸ¯ é€²éšçŸ­å¥</h4>
                    <div class="example-text japanese-text">${word.advanced_phrase.japanese}</div>
                    <div class="example-text romaji-text">${word.advanced_phrase.romaji}</div>
                    <div class="example-text chinese-text">${word.advanced_phrase.chinese}</div>
                </div>
            `;

            card.addEventListener('click', () => {
                studiedWords.add(word.id);
                card.style.border = '2px solid #28a745';
                updateStats();
            });

            return card;
        }

        function searchWords(query) {
            currentFilters.search = query;
            renderWords();
        }

        function filterByPOS(pos, button) {
            // æ¸…é™¤å…¶ä»–æŒ‰éˆ•çš„activeç‹€æ…‹
            document.querySelectorAll('.pos-btn').forEach(btn => btn.classList.remove('active'));
            // è¨­ç½®ç•¶å‰æŒ‰éˆ•ç‚ºactive
            button.classList.add('active');
            
            currentFilters.pos = pos;
            renderWords();
        }

        function filterByLevel(level, button) {
            // æ¸…é™¤å…¶ä»–æŒ‰éˆ•çš„activeç‹€æ…‹
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            // è¨­ç½®ç•¶å‰æŒ‰éˆ•ç‚ºactive
            button.classList.add('active');
            
            currentFilters.level = level;
            renderWords();
        }

        function filterByRange(range) {
            currentFilters.range = range;
            renderWords();
        }

        function toggleGrouping() {
            isGrouped = !isGrouped;
            document.getElementById('groupToggleText').textContent = isGrouped ? 'å–æ¶ˆåˆ†çµ„' : 'æŒ‰è©æ€§åˆ†çµ„';
            renderWords();
        }

        function toggleStudiedOnly() {
            showStudiedOnly = !showStudiedOnly;
            document.getElementById('studiedToggleText').textContent = showStudiedOnly ? 'é¡¯ç¤ºå…¨éƒ¨' : 'åªé¡¯ç¤ºå·²å­¸ç¿’';
            renderWords();
        }

        function randomWord() {
            if (n5Words.length === 0) return;
            const randomIndex = Math.floor(Math.random() * n5Words.length);
            const randomWord = n5Words[randomIndex];
            
            // æš«æ™‚æ¸…é™¤ç¯©é¸ï¼Œåªé¡¯ç¤ºéš¨æ©Ÿå–®å­—
            const tempFilters = {...currentFilters};
            currentFilters = {search: '', pos: '', range: '', level: ''};
            
            const grid = document.getElementById('wordGrid');
            grid.innerHTML = '';
            const card = createWordCard(randomWord);
            grid.appendChild(card);
            
            // æ¢å¾©ç¯©é¸
            setTimeout(() => {
                currentFilters = tempFilters;
            }, 3000);
        }

        function resetView() {
            document.querySelector('.search-box').value = '';
            document.querySelectorAll('.filter-select').forEach(select => select.value = '');
            document.querySelectorAll('.pos-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.level-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.level-btn').classList.add('active'); // N5é è¨­é¸ä¸­
            
            currentFilters = {search: '', pos: '', range: '', level: 'N5'};
            studiedWords.clear();
            isGrouped = false;
            showStudiedOnly = false;
            document.getElementById('groupToggleText').textContent = 'æŒ‰è©æ€§åˆ†çµ„';
            document.getElementById('studiedToggleText').textContent = 'åªé¡¯ç¤ºå·²å­¸ç¿’';
            renderWords();
        }

        function updateStats() {
            const filteredWords = getFilteredWords();
            document.getElementById('totalWords').textContent = filteredWords.length;
            document.getElementById('studiedWords').textContent = studiedWords.size;
            
            const accuracy = n5Words.length > 0 ? Math.round((studiedWords.size / n5Words.length) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadFromJSON();
        });
    </script>
</body>
</html> 